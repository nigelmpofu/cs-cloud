{% load staticfiles %}
<div class="modal fade" id="shareModal" role="dialog" tabindex="-1" aria-labelledby="Sharing" aria-hidden="true">
	<div id="waitOverlay">
		<div class="wait-spinner">
			<span class="spinner"></span>
		</div>
	</div>
	<div class="modal-dialog modal-lg" role="dialog">
		<div class="modal-content text-center">
			<div class="modal-header">
				<h4 class="modal-title" id="shmodalTitle">Share: ...</h4>
				<button type="button" class="close" data-dismiss="modal">&times;</button>
			</div>
			<div class="modal-body" data-keyboard="false">
				<ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
					<li class="nav-item">
						<a class="nav-link active" id="pills-user-tab" data-toggle="pill" href="#pills-user" role="tab" aria-controls="pills-user" aria-selected="true">Users</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" id="pills-group-tab" data-toggle="pill" href="#pills-group" role="tab" aria-controls="pills-group" aria-selected="false">Groups</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" id="pills-public-tab" data-toggle="pill" href="#pills-public" role="tab" aria-controls="pills-public" aria-selected="false">Public Link</a>
					</li>
				</ul>
				<hr>
				<div class="tab-content" id="pills-tabContent">
					<div class="tab-pane fade show active" id="pills-user" role="tabpanel" aria-labelledby="pills-user-tab">User Share</div>
					<div class="tab-pane fade" id="pills-group" role="tabpanel" aria-labelledby="pills-group-tab">Group Share</div>
					<div class="tab-pane fade" id="pills-public" role="tabpanel" aria-labelledby="pills-public-tab">Public Share</div>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" id="closeBtn" data-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
	$(document).ready(function() {
		$(document).ajaxStart(function() {
			$("#waitOverlay").fadeIn(300);
		});
		$(document).ajaxComplete(function() {
			$("#waitOverlay").fadeOut(300);
		});
	});
	$("#shareModal").on("hidden.bs.modal", function() {
		// Clean up on modal close
		$("#shmodalTitle").html("Share: ...");
		$("#md5checksum").html("");
		$("#filename").html("");
		$("#filesize").html("");
		$("#filemodified").html("");
	});
	$('#shareModal').on("shown.bs.modal", function(e) {
		var filePath = $(e.relatedTarget).data('fp');
		$.ajax({
			url: "{% url 'fileDetails' %}",
			type: "POST",
			async: true,
			data: {'csrfmiddlewaretoken': '{{csrf_token}}', 'filepath': filePath},
			dataType: "json",
			success: function(data) {
				$("#shmodalTitle").html("<b>Share:</b> " + data.filename);
				$("#md5checksum").html("<b>MD5:</b> " + data.md5checksum);
				$("#filename").html("<b>Filename:</b> " + data.filename);
				$("#filesize").html("<b>File Size:</b> " + data.filesize);
				$("#filemodified").html("<b>Modified:</b> " + new Date(data.filedate ).toUTCString().replace(/ GMT$/, ""));
			},
			error: function() {
				$("#shmodalTitle").html("<b>Share:</b> Error Loading Details");
				$("#filename").html("<b style=\"color: red;\">Error:</b> File details could not be loaded.");
			},
			failure: function() {
				$("#shmodalTitle").html("<b>Share:</b> Error loading details");
				$("#filename").html("<b style=\"color: red;\">Error:</b> File details could not be loaded.");
			},
			timeout: 5000 // 5 Second timeout
		});
	});
</script>